<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creating a pool set for matchRanges • nullranges</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Creating a pool set for matchRanges">
<meta property="og:description" content="nullranges">
<meta property="og:image" content="https://nullranges.github.io/nullranges/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nullranges</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.5.22</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/nullranges.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/bootRanges.html">Introduction to bootRanges</a>
    </li>
    <li>
      <a href="../articles/matchRanges.html">Introduction to matchRanges</a>
    </li>
    <li>
      <a href="../articles/matching_granges.html">Matching case study I: CTCF occupancy</a>
    </li>
    <li>
      <a href="../articles/matching_ginteractions.html">Matching case study II: CTCF orientation</a>
    </li>
    <li>
      <a href="../articles/matching_pool_set.html">Creating a pool set for matchRanges</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nullranges/nullranges/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Creating a pool set for matchRanges</h1>
                        <h4 data-toc-skip class="author">Eric S.
Davis</h4>
            
            <h4 data-toc-skip class="date">04/24/2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nullranges/nullranges/blob/HEAD/vignettes/matching_pool_set.Rmd" class="external-link"><code>vignettes/matching_pool_set.Rmd</code></a></small>
      <div class="hidden name"><code>matching_pool_set.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code><a href="../reference/matchRanges.html">matchRanges()</a></code> performs subset selection on a pool of
ranges such that chosen covariates are distributionally matched to a
focal set of ranges. However, the generation of a set of pool ranges is
not a trivial task. This vignette provides some guidance for how to
generate a pool of ranges.</p>
<p>For this analysis, we use DNase peaks as a measure of open chromatin,
and ChIP-seq for JUN peaks as a measure of JUN binding. Suppose we are
interested in the properties of chromatin accessibility, but suspect
that JUN-binding impacts accessibility. We can use
<code><a href="../reference/matchRanges.html">matchRanges()</a></code> to control for the DNase signal and the
length of the site so we can compare our JUN-bound sites (i.e., our
<code>focal</code> set) to sites where JUN is not bound (i.e., our
<code>pool</code> set).</p>
</div>
<div class="section level2">
<h2 id="obtaining-example-data">Obtaining example data<a class="anchor" aria-label="anchor" href="#obtaining-example-data"></a>
</h2>
<p>First, we use <code>AnnotationHub</code> to access
<code>GRanges</code> for DNase and JUN narrowPeaks in human (hg19)
GM12878 cells:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">AnnotationHub</span><span class="op">)</span></span>
<span><span class="va">ah</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationHub/man/AnnotationHub-class.html" class="external-link">AnnotationHub</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dnase</span> <span class="op">&lt;-</span> <span class="va">ah</span><span class="op">[[</span><span class="st">"AH30743"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">junPeaks</span> <span class="op">&lt;-</span> <span class="va">ah</span><span class="op">[[</span><span class="st">"AH22814"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">dnase</span></span></code></pre></div>
<pre><code><span><span class="co">## GRanges object with 271214 ranges and 6 metadata columns:</span></span>
<span><span class="co">##            seqnames              ranges strand |        name     score</span></span>
<span><span class="co">##               &lt;Rle&gt;           &lt;IRanges&gt;  &lt;Rle&gt; | &lt;character&gt; &lt;numeric&gt;</span></span>
<span><span class="co">##        [1]     chrM              1-1096      * |      Rank_1      2806</span></span>
<span><span class="co">##        [2]     chrM           1210-4181      * |      Rank_2      2806</span></span>
<span><span class="co">##        [3]     chrM          8868-16581      * |      Rank_3      2806</span></span>
<span><span class="co">##        [4]     chrM           4661-5575      * |      Rank_4      2784</span></span>
<span><span class="co">##        [5]    chr21     9825397-9827624      * |      Rank_5      2741</span></span>
<span><span class="co">##        ...      ...                 ...    ... .         ...       ...</span></span>
<span><span class="co">##   [271210]     chr2   99101766-99101877      * | Rank_271210        20</span></span>
<span><span class="co">##   [271211]     chr6       319032-319131      * | Rank_271211        20</span></span>
<span><span class="co">##   [271212]     chr1 117329477-117329556      * | Rank_271212        20</span></span>
<span><span class="co">##   [271213]     chr1   45985571-45985660      * | Rank_271213        20</span></span>
<span><span class="co">##   [271214]     chr2 101185965-101186044      * | Rank_271214        20</span></span>
<span><span class="co">##            signalValue    pValue    qValue      peak</span></span>
<span><span class="co">##              &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;</span></span>
<span><span class="co">##        [1]     76.6491   280.660   271.178       485</span></span>
<span><span class="co">##        [2]     76.6491   280.660   271.178      2340</span></span>
<span><span class="co">##        [3]     76.6491   280.660   271.178      5029</span></span>
<span><span class="co">##        [4]     76.1730   278.495   271.178       288</span></span>
<span><span class="co">##        [5]     75.2208   274.173   268.040       814</span></span>
<span><span class="co">##        ...         ...       ...       ...       ...</span></span>
<span><span class="co">##   [271210]     2.15692   2.00390   0.46416        71</span></span>
<span><span class="co">##   [271211]     2.15692   2.00390   0.46416        40</span></span>
<span><span class="co">##   [271212]     2.19528   2.00202   0.46235        43</span></span>
<span><span class="co">##   [271213]     2.19528   2.00202   0.46235        42</span></span>
<span><span class="co">##   [271214]     2.19528   2.00202   0.46235        26</span></span>
<span><span class="co">##   -------</span></span>
<span><span class="co">##   seqinfo: 298 sequences (2 circular) from hg19 genome</span></span></code></pre>
<p>Since we want to control for accessibility, we can use the
<code>signalValue</code> from the DNase peaks as a covariate. DNase
sites are also different lengths. If we suspect length might impact
accessibility differently at JUN-bound sites, we can include it as a
covariate as well. For visualization, let’s convert these to log-scale
using <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code> from <code>plyranges</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">plyranges</span><span class="op">)</span></span>
<span><span class="va">dnase</span> <span class="op">&lt;-</span> <span class="va">dnase</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>log10_signal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">signalValue</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>         log10_length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/start.html" class="external-link">width</a></span><span class="op">(</span><span class="va">dnase</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-the-focal-and-pool-sets">Creating the <code>focal</code> and <code>pool</code> sets<a class="anchor" aria-label="anchor" href="#creating-the-focal-and-pool-sets"></a>
</h2>
<p>Next we define our focal and pool sets. The <code>focal</code> set
contains the feature of interest (i.e., DNase peaks bound by JUN),
whereas the <code>pool</code> set lacks this feature (i.e., unbound
DNase peaks). <code><a href="../reference/matchRanges.html">matchRanges()</a></code> is designed to handle datasets
that can be binarized into these two distinct groups. With
<code>plyranges</code> it is easy to filter DNase sites by overlap (or
lack of overlap) with JUN peaks:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Define focal and pool</span></span>
<span><span class="va">focal</span> <span class="op">&lt;-</span> <span class="va">dnase</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plyranges/man/ranges-filter-overlaps.html" class="external-link">filter_by_overlaps</a></span><span class="op">(</span><span class="va">junPeaks</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pool</span> <span class="op">&lt;-</span> <span class="va">dnase</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plyranges/man/ranges-filter-overlaps.html" class="external-link">filter_by_non_overlaps</a></span><span class="op">(</span><span class="va">junPeaks</span><span class="op">)</span></span></code></pre></div>
<p>The focal set must be smaller than the pool set for matching to work
correctly. Matching is most effective when the pool set is much larger
and covers all values in the focal set.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">focal</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2490</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pool</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 268724</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pool</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">focal</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 107.9213</span></span></code></pre>
<p>Before matching, the focal set shows a different distribution of
length and signal than the pool set:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Before matching, focal shows higher</span></span>
<span><span class="co">## signalValue than pool</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/plyranges/man/ranges-bind.html" class="external-link">bind_ranges</a></span><span class="op">(</span>focal<span class="op">=</span><span class="va">focal</span>,</span>
<span>            pool<span class="op">=</span><span class="va">pool</span>,</span>
<span>            .id<span class="op">=</span><span class="st">"set"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols<span class="op">=</span><span class="fu"><a href="https://phanstiellab.github.io/plotgardener/reference/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"log10_length"</span>, <span class="st">"log10_signal"</span><span class="op">)</span>,</span>
<span>               names_to<span class="op">=</span><span class="st">"features"</span>,</span>
<span>               values_to<span class="op">=</span><span class="st">"values"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">values</span>, color<span class="op">=</span><span class="va">set</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">features</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">stat_density</a></span><span class="op">(</span>geom<span class="op">=</span><span class="st">'line'</span>, position<span class="op">=</span><span class="st">'identity'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"DNase sites"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="matching_pool_set_files/figure-html/unnamed-chunk-5-1.png"><!-- --></p>
</div>
<div class="section level2">
<h2 id="obtaining-the-matched-set-with-matchranges">Obtaining the matched set with <code>matchRanges()</code><a class="anchor" aria-label="anchor" href="#obtaining-the-matched-set-with-matchranges"></a>
</h2>
<p>To control for these differences, we can use
<code><a href="../reference/matchRanges.html">matchRanges()</a></code> to select a subset of unbound DNase sites
from the pool that have the same distribution of length and signal.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nullranges.github.io/nullranges">nullranges</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">mgr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchRanges.html">matchRanges</a></span><span class="op">(</span>focal<span class="op">=</span><span class="va">focal</span>,</span>
<span>                   pool<span class="op">=</span><span class="va">pool</span>,</span>
<span>                   covar<span class="op">=</span><span class="op">~</span><span class="va">log10_length</span> <span class="op">+</span> <span class="va">log10_signal</span>,</span>
<span>                   method<span class="op">=</span><span class="st">'rejection'</span>,</span>
<span>                   replace<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mgr</span></span></code></pre></div>
<pre><code><span><span class="co">## MatchedGRanges object with 2490 ranges and 8 metadata columns:</span></span>
<span><span class="co">##          seqnames              ranges strand |        name     score</span></span>
<span><span class="co">##             &lt;Rle&gt;           &lt;IRanges&gt;  &lt;Rle&gt; | &lt;character&gt; &lt;numeric&gt;</span></span>
<span><span class="co">##      [1]    chr13   42242369-42242758      * |  Rank_13919       498</span></span>
<span><span class="co">##      [2]     chr4 148721069-148721751      * |   Rank_6820       733</span></span>
<span><span class="co">##      [3]     chr1 167522710-167523305      * |   Rank_8764       655</span></span>
<span><span class="co">##      [4]    chr22   36771568-36771911      * |  Rank_61304       119</span></span>
<span><span class="co">##      [5]    chr12   27863138-27864123      * |   Rank_9430       628</span></span>
<span><span class="co">##      ...      ...                 ...    ... .         ...       ...</span></span>
<span><span class="co">##   [2486]     chr1 236311692-236312194      * |  Rank_31397       247</span></span>
<span><span class="co">##   [2487]     chr9 135257201-135258016      * |  Rank_10743       592</span></span>
<span><span class="co">##   [2488]     chr6     2842064-2842353      * |  Rank_46877       165</span></span>
<span><span class="co">##   [2489]    chr11     1542262-1543612      * |   Rank_9405       628</span></span>
<span><span class="co">##   [2490]     chr7   90561352-90561734      * |  Rank_44121       176</span></span>
<span><span class="co">##          signalValue    pValue    qValue      peak log10_signal log10_length</span></span>
<span><span class="co">##            &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;    &lt;numeric&gt;    &lt;numeric&gt;</span></span>
<span><span class="co">##      [1]    19.99541   49.8679  46.71972       107     1.322124      2.59218</span></span>
<span><span class="co">##      [2]    21.33174   73.3284  69.75892       208     1.348923      2.83506</span></span>
<span><span class="co">##      [3]    22.83272   65.5173  62.09552       349     1.377174      2.77597</span></span>
<span><span class="co">##      [4]     7.14122   11.9399   9.63032       258     0.910689      2.53782</span></span>
<span><span class="co">##      [5]    23.80406   62.8724  59.48975       599     1.394523      2.99432</span></span>
<span><span class="co">##      ...         ...       ...       ...       ...          ...          ...</span></span>
<span><span class="co">##   [2486]    10.63635   24.7928   22.1325       223     1.065817      2.70243</span></span>
<span><span class="co">##   [2487]    19.80561   59.2923   55.9855       398     1.318180      2.91222</span></span>
<span><span class="co">##   [2488]     8.06895   16.5491   14.1081        93     0.957557      2.46389</span></span>
<span><span class="co">##   [2489]    23.80406   62.8724   59.4898       968     1.394523      3.13098</span></span>
<span><span class="co">##   [2490]     8.43572   17.6751   15.2014       173     0.974775      2.58433</span></span>
<span><span class="co">##   -------</span></span>
<span><span class="co">##   seqinfo: 298 sequences (2 circular) from hg19 genome</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="assessing-covariate-balance">Assessing covariate balance<a class="anchor" aria-label="anchor" href="#assessing-covariate-balance"></a>
</h2>
<p>Now let’s use the <code><a href="../reference/plotCovariate.html">plotCovariate()</a></code> function with
<code>patchwork</code> to visualize how similar our matched distribution
is to focal:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="../reference/covariates.html">covariates</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span>,</span>
<span>       <span class="va">plotCovariate</span>,</span>
<span>       x<span class="op">=</span><span class="va">mgr</span>,</span>
<span>       sets<span class="op">=</span><span class="fu"><a href="https://phanstiellab.github.io/plotgardener/reference/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'f'</span>, <span class="st">'m'</span>, <span class="st">'p'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span><span class="st">'+'</span>, x<span class="op">=</span><span class="va">_</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides<span class="op">=</span><span class="st">"collect"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html" class="external-link">plot_annotation</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"DNase sites"</span>,</span>
<span>                  theme<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust<span class="op">=</span><span class="fl">0.40</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="matching_pool_set_files/figure-html/unnamed-chunk-7-1.png"><!-- --></p>
<p>An important part of propensity-score matching, is assessing
similarity, or balance, between the focal and matched sets. One way is
to visually examine the distributions as we have done above. Another way
is to report summary statistics about the two sets. <code>cobalt</code>
is a package designed to specifically address covariate balance after
covariate matching. Below, we demonstrate how to use <code>cobalt</code>
to calculate the standardized mean differences and visualize these
statistics with a love plot. For more information about assessing
covariate balance, refer to the detailed documentation in the
<code>cobalt</code> vignette:
<code><a href="https://ngreifer.github.io/cobalt/articles/cobalt.html" class="external-link">vignette("cobalt", package = "cobalt")</a></code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ngreifer.github.io/cobalt/" class="external-link">cobalt</a></span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/f.build.html" class="external-link">f.build</a></span><span class="op">(</span><span class="st">"set"</span>, <span class="fu"><a href="../reference/covariates.html">covariates</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               data<span class="op">=</span><span class="fu"><a href="../reference/matchedData.html">matchedData</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="va">set</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="st">'unmatched'</span><span class="op">]</span>,</span>
<span>               distance<span class="op">=</span><span class="st">"ps"</span>,</span>
<span>               focal<span class="op">=</span><span class="st">"focal"</span>,</span>
<span>               which.treat<span class="op">=</span><span class="st">"focal"</span>,</span>
<span>               s.d.denom<span class="op">=</span><span class="st">"all"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance by treatment pair</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  - - - <span style="font-style: italic;">focal (0) vs. matched (1)</span> - - - </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                  Type Diff.Un</span></span>
<span><span class="co">## ps           Distance  0.0594</span></span>
<span><span class="co">## log10_length  Contin.  0.0862</span></span>
<span><span class="co">## log10_signal  Contin.  0.0415</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Sample sizes</span></span></span>
<span><span class="co">##     focal matched</span></span>
<span><span class="co">## All  2490    2490</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  - - - <span style="font-style: italic;">focal (0) vs. pool (1)</span> - - - </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                  Type Diff.Un</span></span>
<span><span class="co">## ps           Distance -1.5447</span></span>
<span><span class="co">## log10_length  Contin. -1.4070</span></span>
<span><span class="co">## log10_signal  Contin. -1.7405</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Sample sizes</span></span></span>
<span><span class="co">##     focal   pool</span></span>
<span><span class="co">## All  2490 268724</span></span>
<span><span class="co">##  - - - - - - - - - - - - - - - - - - - - - - - - -</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://phanstiellab.github.io/plotgardener/reference/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="matching_pool_set_files/figure-html/unnamed-chunk-8-1.png"><!-- --></p>
<p>The “focal vs. matched” comparison shows much lower standardized mean
differences than “focal vs. pool”, indicating that the matched set has
been successfully controlled for covariates of DNAse site length and
signal.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://mikelove.github.io" class="external-link">Michael Love</a>, <a href="https://twitter.com/wancenm" class="external-link">Wancen Mu</a>, <a href="https://ericscottdavis.com" class="external-link">Eric Davis</a>, <a href="http://phanstiel-lab.med.unc.edu" class="external-link">Douglas Phanstiel</a>, <a href="https://stuartlee.org" class="external-link">Stuart Lee</a>, <a href="https://chanzuckerberg.com" class="external-link">CZI</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
