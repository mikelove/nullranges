<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to matchRanges • nullranges</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to matchRanges">
<meta property="og:description" content="nullranges">
<meta property="og:image" content="https://nullranges.github.io/nullranges/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nullranges</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.5.17</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/nullranges.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/bootRanges.html">Introduction to bootRanges</a>
    </li>
    <li>
      <a href="../articles/matchRanges.html">Introduction to matchRanges</a>
    </li>
    <li>
      <a href="../articles/matching_granges.html">Matching case study I: CTCF occupancy</a>
    </li>
    <li>
      <a href="../articles/matching_ginteractions.html">Matching case study II: CTCF orientation</a>
    </li>
    <li>
      <a href="../articles/matching_pool_set.html">Creating a pool set for matchRanges</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nullranges/nullranges/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to matchRanges</h1>
                        <h4 data-toc-skip class="author">Eric S.
Davis</h4>
            
            <h4 data-toc-skip class="date">02/24/2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nullranges/nullranges/blob/HEAD/vignettes/matchRanges.Rmd" class="external-link"><code>vignettes/matchRanges.Rmd</code></a></small>
      <div class="hidden name"><code>matchRanges.Rmd</code></div>

    </div>

    
    
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>When performing statistical analysis on any set of genomic ranges it
is often important to compare focal sets to null sets that are carefully
matched for possible covariates that may influence the analysis. To
address this need, the <code>nullranges</code> package implements
<code><a href="../reference/matchRanges.html">matchRanges()</a></code>, an efficient and convenient tool for
selecting a covariate-matched set of null hypothesis ranges from a pool
of background ranges within the Bioconductor framework.</p>
<p>In this vignette, we provide an overview of
<code><a href="../reference/matchRanges.html">matchRanges()</a></code> and its associated functions. We start with a
simulated example generated with the utility function
<code><a href="../reference/makeExampleMatchedDataSet.html">makeExampleMatchedDataSet()</a></code>. We also provide an overview of
the class struture and a guide for choosing among the supported matching
methods. To see <code><a href="../reference/matchRanges.html">matchRanges()</a></code> used in real biological
examples, visit the <a href="matching_granges.html">Case study I: CTCF
occupancy</a>, and <a href="matching_ginteractions.html">Case study II:
CTCF orientation</a> vignettes.</p>
<p>For a description of the method, see <span class="citation">Davis et
al. (2022)</span>.</p>
<p><em>Temporarily turning off these code chunks while we fix upstream
code</em></p>
</div>
<div class="section level3">
<h3 id="terminology">Terminology<a class="anchor" aria-label="anchor" href="#terminology"></a>
</h3>
<p><code>matchRanges</code> references four sets of data:
<code>focal</code>, <code>pool</code>, <code>matched</code> and
<code>unmatched</code>. The <code>focal</code> set contains the outcome
of interest (<code>Y=1</code>) while the <code>pool</code> set contains
all other observations (<code>Y=0</code>). <code>matchRanges</code>
generates the <code>matched</code> set, which is a subset of the
<code>pool</code> that is matched for provided covariates
(i.e. <code>covar</code>) but does not contain the outcome of interest
(i.e <code>Y=0</code>). Finally, the <code>unmatched</code> set contains
the remaining unselected elements from the <code>pool</code>. The
diagram below depicts the relationships between the four sets.</p>
<p><img src="images/sets.png" title="Sets"></p>
</div>
<div class="section level3">
<h3 id="methodology">Methodology<a class="anchor" aria-label="anchor" href="#methodology"></a>
</h3>
<p><code>matchRanges</code> uses <a href="https://en.wikipedia.org/wiki/Propensity_score_matching" class="external-link">propensity
scores</a> to perform subset selection on the <code>pool</code> set such
that the resulting <code>matched</code> set contains similar
distributions of covariates to that of the <code>focal</code> set. A
propensity score is the conditional probability of assigning an element
(in our case, a genomic range) to a particular outcome (<code>Y</code>)
given a set of covariates. Propensity scores are estimated using a
logistic regression model where the outcome <code>Y=1</code> for
<code>focal</code> and <code>Y=0</code> for <code>pool</code>, over the
provided covariates <code>covar</code>. The resulting propensity scores
are used to select matches using one of three available matching
options: “nearest”, “rejection”, or “stratified” with or without
replacement. For more information see the section on <a href="#choosing_method">Choosing the method parameter</a> below.</p>
</div>
<div class="section level3">
<h3 id="using-matchranges">Using <code>matchRanges()</code><a class="anchor" aria-label="anchor" href="#using-matchranges"></a>
</h3>
<p>We will use a simulated data set to demonstrate matching across
covarying features:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nullranges.github.io/nullranges">nullranges</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeExampleMatchedDataSet.html">makeExampleMatchedDataSet</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">'GRanges'</span><span class="op">)</span></span>
<span><span class="va">x</span></span></code></pre></div>
<pre><code><span><span class="co">## GRanges object with 10500 ranges and 3 metadata columns:</span></span>
<span><span class="co">##           seqnames      ranges strand |  feature1  feature2    feature3</span></span>
<span><span class="co">##              &lt;Rle&gt;   &lt;IRanges&gt;  &lt;Rle&gt; | &lt;logical&gt; &lt;numeric&gt; &lt;character&gt;</span></span>
<span><span class="co">##       [1]     chr1       1-100      * |      TRUE   2.87905           c</span></span>
<span><span class="co">##       [2]     chr1       2-101      * |      TRUE   3.53965           c</span></span>
<span><span class="co">##       [3]     chr1       3-102      * |      TRUE   7.11742           c</span></span>
<span><span class="co">##       [4]     chr1       4-103      * |      TRUE   4.14102           a</span></span>
<span><span class="co">##       [5]     chr1       5-104      * |      TRUE   4.25858           c</span></span>
<span><span class="co">##       ...      ...         ...    ... .       ...       ...         ...</span></span>
<span><span class="co">##   [10496]     chr1 10496-10595      * |     FALSE   1.23578           b</span></span>
<span><span class="co">##   [10497]     chr1 10497-10596      * |     FALSE   1.69671           a</span></span>
<span><span class="co">##   [10498]     chr1 10498-10597      * |     FALSE   6.11140           a</span></span>
<span><span class="co">##   [10499]     chr1 10499-10598      * |     FALSE   2.21657           d</span></span>
<span><span class="co">##   [10500]     chr1 10500-10599      * |     FALSE   5.33003           b</span></span>
<span><span class="co">##   -------</span></span>
<span><span class="co">##   seqinfo: 1 sequence from an unspecified genome; no seqlengths</span></span></code></pre>
<p>Our simulated dataset has 3 features: logical <code>feature1</code>,
numeric <code>feature2</code>, and character/factor
<code>feature3</code>. We can use <code><a href="../reference/matchRanges.html">matchRanges()</a></code> to compare
ranges where <code>feature1</code> is <code>TRUE</code> to ranges where
<code>feature1</code> is <code>FALSE</code>, matched by
<code>feature2</code> and/or <code>feature3</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">mgr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchRanges.html">matchRanges</a></span><span class="op">(</span>focal <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">feature1</span><span class="op">]</span>,</span>
<span>                   pool <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="op">!</span><span class="va">x</span><span class="op">$</span><span class="va">feature1</span><span class="op">]</span>,</span>
<span>                   covar <span class="op">=</span> <span class="op">~</span><span class="va">feature2</span> <span class="op">+</span> <span class="va">feature3</span><span class="op">)</span></span>
<span><span class="va">mgr</span></span></code></pre></div>
<pre><code><span><span class="co">## MatchedGRanges object with 500 ranges and 3 metadata columns:</span></span>
<span><span class="co">##         seqnames      ranges strand |  feature1  feature2    feature3</span></span>
<span><span class="co">##            &lt;Rle&gt;   &lt;IRanges&gt;  &lt;Rle&gt; | &lt;logical&gt; &lt;numeric&gt; &lt;character&gt;</span></span>
<span><span class="co">##     [1]     chr1   4373-4472      * |     FALSE  8.959578           d</span></span>
<span><span class="co">##     [2]     chr1   9740-9839      * |     FALSE  0.959336           e</span></span>
<span><span class="co">##     [3]     chr1   7755-7854      * |     FALSE  2.107003           c</span></span>
<span><span class="co">##     [4]     chr1   8266-8365      * |     FALSE  6.231860           d</span></span>
<span><span class="co">##     [5]     chr1   4298-4397      * |     FALSE  6.955316           c</span></span>
<span><span class="co">##     ...      ...         ...    ... .       ...       ...         ...</span></span>
<span><span class="co">##   [496]     chr1   2443-2542      * |     FALSE   1.12276           b</span></span>
<span><span class="co">##   [497]     chr1   2455-2554      * |     FALSE   3.38518           c</span></span>
<span><span class="co">##   [498]     chr1   1285-1384      * |     FALSE   1.58546           c</span></span>
<span><span class="co">##   [499]     chr1 10137-10236      * |     FALSE   9.39272           c</span></span>
<span><span class="co">##   [500]     chr1   6119-6218      * |     FALSE  10.22412           c</span></span>
<span><span class="co">##   -------</span></span>
<span><span class="co">##   seqinfo: 1 sequence from an unspecified genome; no seqlengths</span></span></code></pre>
<p>The resulting <code>MatchedGRanges</code> object is a set of null
hypothesis ranges selected from our <code>pool</code> of options that is
the same length as our input <code>focal</code> ranges and matched for
<code>covar</code> features 2 and 3. These matched ranges print and
behave just as normal <code>GRanges</code> would:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/GenomicRanges" class="external-link">GenomicRanges</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## MatchedGRanges object with 500 ranges and 3 metadata columns:</span></span>
<span><span class="co">##         seqnames      ranges strand |  feature1  feature2    feature3</span></span>
<span><span class="co">##            &lt;Rle&gt;   &lt;IRanges&gt;  &lt;Rle&gt; | &lt;logical&gt; &lt;numeric&gt; &lt;character&gt;</span></span>
<span><span class="co">##     [1]     chr1     511-610      * |     FALSE  5.545186           c</span></span>
<span><span class="co">##     [2]     chr1     513-612      * |     FALSE  2.221684           b</span></span>
<span><span class="co">##     [3]     chr1     534-633      * |     FALSE  1.563458           b</span></span>
<span><span class="co">##     [4]     chr1     565-664      * |     FALSE  0.932659           c</span></span>
<span><span class="co">##     [5]     chr1     577-676      * |     FALSE  3.256908           c</span></span>
<span><span class="co">##     ...      ...         ...    ... .       ...       ...         ...</span></span>
<span><span class="co">##   [496]     chr1 10377-10476      * |     FALSE  0.795032           c</span></span>
<span><span class="co">##   [497]     chr1 10380-10479      * |     FALSE  0.977984           b</span></span>
<span><span class="co">##   [498]     chr1 10409-10508      * |     FALSE  3.662119           c</span></span>
<span><span class="co">##   [499]     chr1 10455-10554      * |     FALSE  6.815473           c</span></span>
<span><span class="co">##   [500]     chr1 10483-10582      * |     FALSE  3.724147           c</span></span>
<span><span class="co">##   -------</span></span>
<span><span class="co">##   seqinfo: 1 sequence from an unspecified genome; no seqlengths</span></span></code></pre>
<p>We can change the <code>type</code> argument of
<code>makeExampleMatchedDataSet</code> to input data.frames,
data.tables, DataFrames, GRanges and GInteractions objects - all of
which work as inputs for <code>matchRanges</code>. These produce either
<code>MatchedDataFrame</code>, <code>MatchedGRanges</code>, or
<code>MatchedGInteractions</code> objects. For more information about
the <code>Matched</code> class structure and available methods, see the
<a href="#class-structure">Class structure</a> section below or the help
documentation for each class, <code><a href="../reference/MatchedDataFrame.html">?MatchedDataFrame</a></code>,
<code><a href="../reference/MatchedGRanges.html">?MatchedGRanges</a></code>, or <code><a href="../reference/MatchedGInteractions.html">?MatchedGInteractions</a></code>.</p>
<p><code><a href="../reference/matchRanges.html">matchRanges()</a></code> uses <a href="https://en.wikipedia.org/wiki/Propensity_score_matching" class="external-link">propensity
scores</a> to select matches using one of three available matching
options: “nearest”, “rejection”, or “stratified” with or without
replacement. For more information see the section on <a href="#choosing_method">Choosing the method parameter</a> below.</p>
<div class="section level4">
<h4 id="assessing-quality-of-matching">Assessing quality of matching<a class="anchor" aria-label="anchor" href="#assessing-quality-of-matching"></a>
</h4>
<p>We can assess the quality of <code>Matched</code> classes with
<code><a href="../reference/overview.html">overview()</a></code>, <code><a href="../reference/plotCovariate.html">plotCovariate()</a></code>, and
<code><a href="../reference/plotPropensity.html">plotPropensity()</a></code>. <code><a href="../reference/overview.html">overview()</a></code> provides a quick
assessment of overall matching quality by reporting the mean and
standard deviation for covariates and propensity scores of the focal,
pool, matched, and unmatched sets. For factor, character, or logical
covariates (e.g. categorical covariates) the N per set (frequency) is
returned. It also reports the mean difference in focal-matched sets:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/overview.html">overview</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## MatchedGRanges object: </span></span>
<span><span class="co">##        set     N feature2.mean feature2.sd feature3.a feature3.b feature3.c</span></span>
<span><span class="co">##      focal   500           4.1         1.9         66        157        206</span></span>
<span><span class="co">##    matched   500           4.5         2.7         34        160        234</span></span>
<span><span class="co">##       pool 10000           6.0         3.4       4248       3121       1117</span></span>
<span><span class="co">##  unmatched  9500           6.1         3.5       4214       2961        883</span></span>
<span><span class="co">##  feature3.d feature3.e ps.mean ps.sd</span></span>
<span><span class="co">##          49         22   0.100 0.076</span></span>
<span><span class="co">##          53         19   0.110 0.078</span></span>
<span><span class="co">##         992        522   0.045 0.051</span></span>
<span><span class="co">##         939        503   0.041 0.047</span></span>
<span><span class="co">## --------</span></span>
<span><span class="co">## focal - matched: </span></span>
<span><span class="co">##  feature2.mean feature2.sd feature3.a feature3.b feature3.c feature3.d</span></span>
<span><span class="co">##          -0.42       -0.84         32         -3        -28         -4</span></span>
<span><span class="co">##  feature3.e ps.mean   ps.sd</span></span>
<span><span class="co">##           3 -0.0057 -0.0019</span></span></code></pre>
<p>Visualizing propensity scores can show how well sets were matched
overall:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotPropensity.html">plotPropensity</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span></span></code></pre></div>
<p><img src="matchRanges_files/figure-html/unnamed-chunk-6-1.png"><!-- --></p>
<p>The distributions of features can be visualized in each set with
<code><a href="../reference/plotCovariate.html">plotCovariate()</a></code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotCovariate.html">plotCovariate</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span></span></code></pre></div>
<p><img src="matchRanges_files/figure-html/unnamed-chunk-7-1.png"><!-- --></p>
<p>Since these functions return ggplots, <code>patchwork</code> can be
used to visualize all covariates like this:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="../reference/covariates.html">covariates</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span>, <span class="va">plotCovariate</span>, x<span class="op">=</span><span class="va">mgr</span>, sets <span class="op">=</span> <span class="fu"><a href="https://phanstiellab.github.io/plotgardener/reference/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'f'</span>, <span class="st">'m'</span>, <span class="st">'p'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span><span class="st">'/'</span>, <span class="va">plots</span><span class="op">)</span></span></code></pre></div>
<p><img src="matchRanges_files/figure-html/unnamed-chunk-8-1.png"><!-- --></p>
<p>By default, continuous features are plotted as density line plots
while categorical features are plotted as stacked bar plots. All sets
are also shown by default. Defaults can be overridden by setting the
<code>type</code> and <code>sets</code> arguments.</p>
<p>Results from <code>matchRanges</code> can also be used in conjunction
with <code>cobalt</code> for assessing covariate balance. We recommend
using <code>cobalt</code> to calculate and report summary statistics to
indicate adequately matched sets. For more detail on assessing covariate
balance, refer to the detailed documentation on this topic in the
<code>cobalt</code> vignette:
<code><a href="https://ngreifer.github.io/cobalt/articles/cobalt.html" class="external-link">vignette("cobalt", package = "cobalt")</a></code>. For an example on
how to use <code>cobalt</code> with <code>matchRanges</code> see <a href="#using_cobalt">Using <code>cobalt</code> to assess
balancing</a>.</p>
</div>
<div class="section level4">
<h4 id="accessing-matched-data">Accessing matched data<a class="anchor" aria-label="anchor" href="#accessing-matched-data"></a>
</h4>
<p>Custom plots can be made by extracting data from the
<code>Matched</code> object:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/matchedData.html">matchedData</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        id feature2 feature3         ps       set</span></span>
<span><span class="co">##     1:  1 2.879049        c 0.21095908     focal</span></span>
<span><span class="co">##     2:  1 3.539645        c 0.19210984     focal</span></span>
<span><span class="co">##     3:  1 7.117417        c 0.11193396     focal</span></span>
<span><span class="co">##     4:  1 4.141017        a 0.01771986     focal</span></span>
<span><span class="co">##     5:  1 4.258575        c 0.17308581     focal</span></span>
<span><span class="co">##    ---                                          </span></span>
<span><span class="co">## 20496:  0 1.235781        b 0.08945367 unmatched</span></span>
<span><span class="co">## 20497:  0 1.696712        a 0.02707977 unmatched</span></span>
<span><span class="co">## 20498:  0 6.111404        a 0.01255772 unmatched</span></span>
<span><span class="co">## 20499:  0 2.216575        d 0.07578989 unmatched</span></span>
<span><span class="co">## 20500:  0 5.330029        b 0.04535856 unmatched</span></span></code></pre>
<p>Attributes of the <code>Matched</code> object can be extracted with
the following accessor functions:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/covariates.html">covariates</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/withReplacement.html">withReplacement</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "feature2" "feature3"</span></span>
<span><span class="co">## [1] "rejection"</span></span>
<span><span class="co">## [1] FALSE</span></span></code></pre>
<p>Each set can also be extracted with the following accessor
functions:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="../reference/focal.html">focal</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="../reference/matched.html">matched</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="../reference/unmatched.html">unmatched</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "GRanges object with 500 ranges and 3 metadata columns"</span></span>
<span><span class="co">## [1] "GRanges object with 10000 ranges and 3 metadata columns"</span></span>
<span><span class="co">## [1] "GRanges object with 500 ranges and 3 metadata columns"</span></span>
<span><span class="co">## [1] "GRanges object with 9500 ranges and 3 metadata columns"</span></span></code></pre>
<p>The <code><a href="../reference/indices.html">indices()</a></code> function can be used to find the original
indices for each set. For example,
<code>indices(x, set="matched")</code> will supply the indices from the
<code>pool</code> set that corresponds to the <code>matched</code> set.
In fact, <code>matched(x)</code> is a convenient wrapper around
<code>pool(x)[indices(x, set='matched')</code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="../reference/matched.html">matched</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span>, <span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="../reference/indices.html">indices</a></span><span class="op">(</span><span class="va">mgr</span>, set <span class="op">=</span> <span class="st">'matched'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="using-cobalt-to-assess-balancing">Using <code>cobalt</code> to assess balancing
<a id="using_cobalt"></a><a class="anchor" aria-label="anchor" href="#using-cobalt-to-assess-balancing"></a>
</h4>
<p>This is straight-forward by accessing the data with
<code>matchedData(x)</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ngreifer.github.io/cobalt/" class="external-link">cobalt</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  cobalt (Version 4.4.1, Build Date: 2022-11-03)</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/f.build.html" class="external-link">f.build</a></span><span class="op">(</span><span class="st">"set"</span>, <span class="fu"><a href="../reference/covariates.html">covariates</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               data <span class="op">=</span> <span class="fu"><a href="../reference/matchedData.html">matchedData</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span>,</span>
<span>               distance <span class="op">=</span> <span class="st">"ps"</span>, <span class="co"># name of column containing propensity score</span></span>
<span>               focal <span class="op">=</span> <span class="st">"focal"</span>, <span class="co"># name of focal group in set column</span></span>
<span>               which.treat <span class="op">=</span> <span class="st">"focal"</span>, <span class="co"># compare everything to focal</span></span>
<span>               s.d.denom <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span> <span class="co"># how to adjust standard deviation</span></span>
<span></span>
<span><span class="va">res</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance by treatment pair</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  - - - <span style="font-style: italic;">focal (0) vs. matched (1)</span> - - - </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                Type Diff.Un</span></span>
<span><span class="co">## ps         Distance  0.1088</span></span>
<span><span class="co">## feature2    Contin.  0.1242</span></span>
<span><span class="co">## feature3_a   Binary -0.0640</span></span>
<span><span class="co">## feature3_b   Binary  0.0060</span></span>
<span><span class="co">## feature3_c   Binary  0.0560</span></span>
<span><span class="co">## feature3_d   Binary  0.0080</span></span>
<span><span class="co">## feature3_e   Binary -0.0060</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Sample sizes</span></span></span>
<span><span class="co">##     focal matched</span></span>
<span><span class="co">## All   500     500</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  - - - <span style="font-style: italic;">focal (0) vs. pool (1)</span> - - - </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                Type Diff.Un</span></span>
<span><span class="co">## ps         Distance -1.1340</span></span>
<span><span class="co">## feature2    Contin.  0.5520</span></span>
<span><span class="co">## feature3_a   Binary  0.2928</span></span>
<span><span class="co">## feature3_b   Binary -0.0019</span></span>
<span><span class="co">## feature3_c   Binary -0.3003</span></span>
<span><span class="co">## feature3_d   Binary  0.0012</span></span>
<span><span class="co">## feature3_e   Binary  0.0082</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Sample sizes</span></span></span>
<span><span class="co">##     focal  pool</span></span>
<span><span class="co">## All   500 10000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  - - - <span style="font-style: italic;">focal (0) vs. unmatched (1)</span> - - - </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                Type Diff.Un</span></span>
<span><span class="co">## ps         Distance -1.1994</span></span>
<span><span class="co">## feature2    Contin.  0.5745</span></span>
<span><span class="co">## feature3_a   Binary  0.3116</span></span>
<span><span class="co">## feature3_b   Binary -0.0023</span></span>
<span><span class="co">## feature3_c   Binary -0.3191</span></span>
<span><span class="co">## feature3_d   Binary  0.0008</span></span>
<span><span class="co">## feature3_e   Binary  0.0089</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Sample sizes</span></span></span>
<span><span class="co">##     focal unmatched</span></span>
<span><span class="co">## All   500      9500</span></span>
<span><span class="co">##  - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/love.plot.html" class="external-link">love.plot</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Standardized mean differences and raw mean differences are present in the same plot. </span></span>
<span><span class="co">## Use the 'stars' argument to distinguish between them and appropriately label the x-axis.</span></span></code></pre>
<p><img src="matchRanges_files/figure-html/unnamed-chunk-13-1.png"><!-- --></p>
</div>
</div>
<div class="section level3">
<h3 id="choosing-the-method-parameter">Choosing the <code>method</code> parameter
<a id="choosing_method"></a><a class="anchor" aria-label="anchor" href="#choosing-the-method-parameter"></a>
</h3>
<p>There are currently 3 available methods for selecting a matched
set:</p>
<ol style="list-style-type: decimal">
<li><p>Nearest-neighbor matching with replacement</p></li>
<li><p>Rejection sampling with/without replacement</p></li>
<li><p>Stratified sampling with/without replacement</p></li>
</ol>
<p>Currently, nearest-neighbor matching without replacement is not
implemented, but stratified sampling without replacement is a suitable
substitute.</p>
<div class="section level4">
<h4 id="nearest-neighbor-matching">Nearest-neighbor matching<a class="anchor" aria-label="anchor" href="#nearest-neighbor-matching"></a>
</h4>
<p>Attempts to find the nearest neighbor for each range by using a
rolling-join (as implemented in the <code>data.table</code> package)
between <code>focal</code> and <code>pool</code> propensity scores.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">mgr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchRanges.html">matchRanges</a></span><span class="op">(</span>focal <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">feature1</span><span class="op">]</span>,</span>
<span>                   pool <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="op">!</span><span class="va">x</span><span class="op">$</span><span class="va">feature1</span><span class="op">]</span>,</span>
<span>                   covar <span class="op">=</span> <span class="op">~</span><span class="va">feature2</span> <span class="op">+</span> <span class="va">feature3</span>,</span>
<span>                   method <span class="op">=</span> <span class="st">'nearest'</span>,</span>
<span>                   replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/overview.html">overview</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotPropensity.html">plotPropensity</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span></span></code></pre></div>
<p><img src="matchRanges_files/figure-html/unnamed-chunk-14-1.png"><!-- --></p>
<p>This method is best if you have a very large dataset because it is
usually the fastest matching method. However, because sampling is done
with replacement the user should be careful to assess the number of
duplicate ranges pulled. This can be done using the
<code><a href="../reference/indices.html">indices()</a></code> function:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Total number of duplicated indices</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="fu"><a href="../reference/indices.html">indices</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="../reference/indices.html">indices</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># used more than once</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="../reference/indices.html">indices</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># used more than twice</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="../reference/indices.html">indices</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">3</span><span class="op">)</span> <span class="co"># used more than thrice</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 59</span></span>
<span><span class="co">## [1] 51</span></span>
<span><span class="co">## [1] 8</span></span>
<span><span class="co">## [1] 0</span></span></code></pre>
<p>Duplicate ranges can be pulled since this method selects the closest
matching propensity-score in the focal set to each range in the pool
set. It is important to inspect the duplicates when using this method
particularly when there are very few well-matching options to select
from in your pool set to ensure your matched set has a diverse set of
ranges.</p>
<p>Nearest neighbor matching without replacement is not currently
supported due to its computational complexity. However, stratified
sampling without replacement is an acceptable alternative.</p>
</div>
<div class="section level4">
<h4 id="rejection-sampling">Rejection sampling<a class="anchor" aria-label="anchor" href="#rejection-sampling"></a>
</h4>
<p>Uses a probability-based approach to select options in the
<code>pool</code> that distributionally match the <code>focal</code> set
based on propensity scores. The rejection sampling method first
generates kernal-density estimates for both the focal and pool sets.
Then a scale factor is determined by finding the point at which the
difference in focal and pool densities is maximized. This scale factor
is then applied such that the pool distribution covers the focal
distribution at all points. Random sampling is then conducted, with
probability of accepting a pool range into the matched set given by the
ratio between the height of the density and the scaled (covering)
density. If <code>method</code> or <code>replace</code> is not supplied,
the default values are rejection sampling without replacement.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">mgr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchRanges.html">matchRanges</a></span><span class="op">(</span>focal <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">feature1</span><span class="op">]</span>,</span>
<span>                   pool <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="op">!</span><span class="va">x</span><span class="op">$</span><span class="va">feature1</span><span class="op">]</span>,</span>
<span>                   covar <span class="op">=</span> <span class="op">~</span><span class="va">feature2</span> <span class="op">+</span> <span class="va">feature3</span>,</span>
<span>                   method <span class="op">=</span> <span class="st">'rejection'</span>,</span>
<span>                   replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">rs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/overview.html">overview</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotPropensity.html">plotPropensity</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span></span></code></pre></div>
<p><img src="matchRanges_files/figure-html/unnamed-chunk-16-1.png"><!-- --></p>
<p>Rejection sampling is the fastest available matching method for
sampling without replacement. Therefore, it is ideal to use on large
datasets when sampling without replacement is important. However, this
method can be unstable, particularly when the pool set is not much
larger than the focal set. In those cases, the best method to use is
stratified sampling.</p>
</div>
<div class="section level4">
<h4 id="stratified-sampling">Stratified sampling<a class="anchor" aria-label="anchor" href="#stratified-sampling"></a>
</h4>
<p>Performs iterative sampling on increasingly large bins of data.
<code>focal</code> and <code>pool</code> propensity scores are binned by
their value with high granularity, options are randomly selected (with
or without replacement) within each bin and subsequently removed from
the pool of available options. This procedure is repeated, decreasing
the number of bins (and increasing bin size) until the number of
selected matches is equal to the focal set. While matches are being
found in each bin the bins stay small. However, as the number of bins
with no matches increases the algorithm expands bin size faster, which
maintains matching quality while decreasing run-time.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">mgr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchRanges.html">matchRanges</a></span><span class="op">(</span>focal <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">feature1</span><span class="op">]</span>,</span>
<span>                   pool <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="op">!</span><span class="va">x</span><span class="op">$</span><span class="va">feature1</span><span class="op">]</span>,</span>
<span>                   covar <span class="op">=</span> <span class="op">~</span><span class="va">feature2</span> <span class="op">+</span> <span class="va">feature3</span>,</span>
<span>                   method <span class="op">=</span> <span class="st">'stratified'</span>,</span>
<span>                   replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/overview.html">overview</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotPropensity.html">plotPropensity</a></span><span class="op">(</span><span class="va">mgr</span><span class="op">)</span></span></code></pre></div>
<p><img src="matchRanges_files/figure-html/unnamed-chunk-17-1.png"><!-- --></p>
<p>For very large data sets, users might notice a slight increase in run
time compared to the other methods. Stratified sampling tends to work
very well for discrete data, and often produces the best matches even on
continuous data:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Extract difference in propensity scores</span></span>
<span><span class="co">## between focal and matched sets</span></span>
<span><span class="va">fmps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://phanstiellab.github.io/plotgardener/reference/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nn</span>, <span class="va">rs</span>, <span class="va">ss</span><span class="op">)</span>, <span class="va">`[[`</span>, <span class="st">"quality"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://phanstiellab.github.io/plotgardener/reference/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'nearest'</span>, <span class="st">'rejection'</span>, <span class="st">'stratified'</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">fmps</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "stratified"</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="class-structure">Class structure<a class="anchor" aria-label="anchor" href="#class-structure"></a>
</h3>
<p>Since <code><a href="../reference/matchRanges.html">matchRanges()</a></code> automatically constructs the
relevant classes, this section is not essential for using any of the
<code>nullranges</code> package functionality. Instead, this section
serves as a guide for developers who wish to extend these classes or
those more interested in S4 implementation details.</p>
<div class="section level4">
<h4 id="implementation-details">Implementation details<a class="anchor" aria-label="anchor" href="#implementation-details"></a>
</h4>
<p><code><a href="../reference/matchRanges.html">matchRanges()</a></code> acts as a constructor, combining a
<code>Matched</code> superclass - which contains the matching results -
with either a
<code>DataFrame</code>(<code>data.frame</code>/<code>data.table</code>),
<code>GRanges</code>, or <code>GInteractions</code> superclass. This
results in the <code>MatchedDataFrame</code>,
<code>MatchedGRanges</code>, or <code>MatchedGInteractions</code>
subclasses.</p>
<p><img src="images/class_structure.png" title="Class structure"></p>
<p>Internally, each <code>Matched</code> subclass uses a “delegate”
object of the same type to assign its slots. The delegate object used is
the <code>matched</code> set. Therefore, the resulting
<code>Matched*</code> object behaves as a combination of both its
superclasses - with access to methods from both.</p>
<p>For example, using <code><a href="../reference/matchRanges.html">matchRanges()</a></code> on <code>GRanges</code>
objects assigns a <code>GRanges</code> delegate object which is used to
populate GRanges-specific slots. This results in a
<code>MatchedGRanges</code> object, with access to both
<code>Matched</code> functions (e.g. <code>plotCovariate</code>) as well
as normal <code>GRanges</code> methods (e.g.s <code>seqnames</code>,
<code>resize</code>, etc…).</p>
</div>
</div>
<div class="section level2">
<h2 id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R Under development (unstable) (2023-02-16 r83857)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.1 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">## [8] base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] cobalt_4.4.1         patchwork_1.1.2      GenomicRanges_1.51.4</span></span>
<span><span class="co">## [4] GenomeInfoDb_1.35.15 IRanges_2.33.0       S4Vectors_0.37.3    </span></span>
<span><span class="co">## [7] BiocGenerics_0.45.0  nullranges_1.5.17   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] tidyselect_1.2.0            farver_2.1.1               </span></span>
<span><span class="co">##  [3] dplyr_1.1.0                 Biostrings_2.67.0          </span></span>
<span><span class="co">##  [5] bitops_1.0-7                fastmap_1.1.0              </span></span>
<span><span class="co">##  [7] RCurl_1.98-1.10             pracma_2.4.2               </span></span>
<span><span class="co">##  [9] GenomicAlignments_1.35.0    XML_3.99-0.13              </span></span>
<span><span class="co">## [11] digest_0.6.31               lifecycle_1.0.3            </span></span>
<span><span class="co">## [13] ellipsis_0.3.2              plyranges_1.19.0           </span></span>
<span><span class="co">## [15] magrittr_2.0.3              compiler_4.3.0             </span></span>
<span><span class="co">## [17] progress_1.2.2              rlang_1.0.6                </span></span>
<span><span class="co">## [19] sass_0.4.5                  tools_4.3.0                </span></span>
<span><span class="co">## [21] utf8_1.2.3                  yaml_2.3.7                 </span></span>
<span><span class="co">## [23] data.table_1.14.8           rtracklayer_1.59.1         </span></span>
<span><span class="co">## [25] knitr_1.42                  prettyunits_1.1.1          </span></span>
<span><span class="co">## [27] labeling_0.4.2              mclust_6.0.0               </span></span>
<span><span class="co">## [29] DelayedArray_0.25.0         BiocParallel_1.33.9        </span></span>
<span><span class="co">## [31] KernSmooth_2.23-20          withr_2.5.0                </span></span>
<span><span class="co">## [33] purrr_1.0.1                 desc_1.4.2                 </span></span>
<span><span class="co">## [35] grid_4.3.0                  fansi_1.0.4                </span></span>
<span><span class="co">## [37] colorspace_2.1-0            ggplot2_3.4.1              </span></span>
<span><span class="co">## [39] scales_1.2.1                MASS_7.3-58.2              </span></span>
<span><span class="co">## [41] ggridges_0.5.4              SummarizedExperiment_1.29.1</span></span>
<span><span class="co">## [43] cli_3.6.0                   mvtnorm_1.1-3              </span></span>
<span><span class="co">## [45] rmarkdown_2.20              crayon_1.5.2               </span></span>
<span><span class="co">## [47] ragg_1.2.5                  generics_0.1.3             </span></span>
<span><span class="co">## [49] rjson_0.2.21                DBI_1.1.3                  </span></span>
<span><span class="co">## [51] cachem_1.0.6                stringr_1.5.0              </span></span>
<span><span class="co">## [53] zlibbioc_1.45.0             parallel_4.3.0             </span></span>
<span><span class="co">## [55] XVector_0.39.0              restfulr_0.0.15            </span></span>
<span><span class="co">## [57] matrixStats_0.63.0          vctrs_0.5.2                </span></span>
<span><span class="co">## [59] Matrix_1.5-3                jsonlite_1.8.4             </span></span>
<span><span class="co">## [61] hms_1.1.2                   systemfonts_1.0.4          </span></span>
<span><span class="co">## [63] speedglm_0.3-4              jquerylib_0.1.4            </span></span>
<span><span class="co">## [65] glue_1.6.2                  pkgdown_2.0.7              </span></span>
<span><span class="co">## [67] codetools_0.2-19            stringi_1.7.12             </span></span>
<span><span class="co">## [69] gtable_0.3.1                BiocIO_1.9.2               </span></span>
<span><span class="co">## [71] munsell_0.5.0               tibble_3.1.8               </span></span>
<span><span class="co">## [73] pillar_1.8.1                htmltools_0.5.4            </span></span>
<span><span class="co">## [75] GenomeInfoDbData_1.2.9      R6_2.5.1                   </span></span>
<span><span class="co">## [77] textshaping_0.3.6           ks_1.14.0                  </span></span>
<span><span class="co">## [79] rprojroot_2.0.3             evaluate_0.20              </span></span>
<span><span class="co">## [81] lattice_0.20-45             Biobase_2.59.0             </span></span>
<span><span class="co">## [83] highr_0.10                  backports_1.4.1            </span></span>
<span><span class="co">## [85] Rsamtools_2.15.1            memoise_2.0.1              </span></span>
<span><span class="co">## [87] bslib_0.4.2                 Rcpp_1.0.10                </span></span>
<span><span class="co">## [89] InteractionSet_1.27.0       xfun_0.37                  </span></span>
<span><span class="co">## [91] fs_1.6.1                    MatrixGenerics_1.11.0      </span></span>
<span><span class="co">## [93] pkgconfig_2.0.3</span></span></code></pre>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-matchRanges" class="csl-entry">
Davis, Eric S., Wancen Mu, Stuart Lee, Mikhail G. Dozmorov, Michael I.
Love, and Douglas H. Phanstiel. 2022. <span>“matchRanges: Generating
Null Hypothesis Genomic Ranges via Covariate-Matched Sampling.”</span>
<em>bioRxiv</em>. <a href="https://doi.org/10.1101/2022.08.05.502985" class="external-link">https://doi.org/10.1101/2022.08.05.502985</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://mikelove.github.io" class="external-link">Michael Love</a>, <a href="https://twitter.com/wancenm" class="external-link">Wancen Mu</a>, <a href="https://ericscottdavis.com" class="external-link">Eric Davis</a>, <a href="http://phanstiel-lab.med.unc.edu" class="external-link">Douglas Phanstiel</a>, <a href="https://stuartlee.org" class="external-link">Stuart Lee</a>, <a href="https://chanzuckerberg.com" class="external-link">CZI</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
